services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        BUILD_SHA: ${BUILD_SHA:-local}
        BUILD_TIME: ${BUILD_TIME:-now}
    image: spotify-echo:local
    container_name: spotify-echo-app
    ports:
      - "${PORT:-3000}:3000"
    environment:
      NODE_ENV: development
      PORT: 3000
      JWT_SECRET: ${JWT_SECRET:-dev-secret}
      SESSION_SECRET: ${SESSION_SECRET:-dev-session}
      ENABLE_MOCK_PROVIDER: ${ENABLE_MOCK_PROVIDER:-true}
      DISABLE_REALTIME: ${DISABLE_REALTIME:-true}
      ENABLE_TRACING: ${ENABLE_TRACING:-false}
      ENABLE_AGENTOPS: ${ENABLE_AGENTOPS:-false}
      PUPPETEER_SKIP_DOWNLOAD: "true"
      PUPPETEER_SKIP_CHROMIUM_DOWNLOAD: "true"
      PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD: "1"
    volumes:
      - ./.env:/app/.env:ro
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://127.0.0.1:3000/healthz"]
      interval: 30s
      timeout: 5s
      retries: 5
    command: ["node", "server.js"]